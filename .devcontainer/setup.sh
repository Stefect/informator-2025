#!/bin/bash
# Informator Codespaces Setup Script
# ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰Ð° Ð´Ð»Ñ GitHub Codespaces

echo "ðŸš€ ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Informator Ð² GitHub Codespaces..."

# ÐžÐ½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð¸
echo "ðŸ“¦ ÐžÐ½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð¿Ð°ÐºÐµÑ‚Ñ–Ð²..."
sudo apt-get update -y

# Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð¸Ñ… Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ–Ð² Ð´Ð»Ñ C++
echo "ðŸ”§ Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ C++ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ–Ð²..."
sudo apt-get install -y build-essential python3-dev

# Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¸Ñ… npm Ð¿Ð°ÐºÐµÑ‚Ñ–Ð²
echo "ðŸ“¦ Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¸Ñ… npm Ð¿Ð°ÐºÐµÑ‚Ñ–Ð²..."
npm install -g typescript ts-node nodemon concurrently

# Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð´Ð»Ñ Ð²ÑÑ–Ñ… Ð¼Ð¾Ð´ÑƒÐ»Ñ–Ð²
echo "ðŸ“¦ Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñƒ..."

# Backend
echo "ðŸ”§ Backend Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚Ñ–..."
cd backend
npm install
cd ..

# Client (Ð¼Ð¾Ð¶Ðµ Ð½Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ C++ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð² Linux)
echo "ðŸ”§ Client Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚Ñ–..."
cd client
npm install || echo "âš ï¸  C++ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð¼Ð¾Ð¶Ðµ Ð½Ðµ Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÑƒÐ²Ð°Ñ‚Ð¸ÑÑ Ð² Linux Codespace"
cd ..

# Windows module (Ð¾ÑÐ½Ð¾Ð²Ð½Ð¸Ð¹ Ð²ÐµÐ± ÑÐµÑ€Ð²ÐµÑ€)
echo "ðŸ”§ Windows module Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚Ñ–..."
cd windows
npm install
cd ..

# Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ð¹Ð½Ð¸Ñ… Ñ„Ð°Ð¹Ð»Ñ–Ð²
echo "âš™ï¸  Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ñ—..."

# .env Ð´Ð»Ñ production
cat > .env << EOF
NODE_ENV=development
CODESPACES=true
PORT=8080
API_PORT=3000
WS_PORT=8888
CORS_ORIGIN=*
HOST=0.0.0.0
EOF

# Ð›Ð¾Ð³ÑƒÐ²Ð°Ð½Ð½Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð½Ñ
echo "âœ… ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾!"
echo "ðŸŒ Ð“Ð¾Ñ‚Ð¾Ð²Ð¾ Ð´Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÑƒ Ð² Codespaces"
echo ""
echo "ðŸ“‹ ÐÐ°ÑÑ‚ÑƒÐ¿Ð½Ñ– ÐºÑ€Ð¾ÐºÐ¸:"
echo "   1. Ð—Ð°Ð¿ÑƒÑÑ‚Ñ–Ñ‚ÑŒ: npm run codespaces"
echo "   2. Ð’Ñ–Ð´ÐºÑ€Ð¸Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚ 8080 Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ Ð´Ð¾ Ñ–Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑƒ"
echo "   3. ÐŸÐ¾Ð´Ñ–Ð»Ñ–Ñ‚ÑŒÑÑ Ð¿ÑƒÐ±Ð»Ñ–Ñ‡Ð½Ð¸Ð¼ URL!"
echo ""