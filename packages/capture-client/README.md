# üé• Capture Client

Windows –∫–ª—ñ—î–Ω—Ç –¥–ª—è –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è–º —Ä–µ—Å—É—Ä—Å—ñ–≤.

## üìã –û–ø–∏—Å

Capture Client - —Ü–µ Node.js –ø—Ä–æ–≥—Ä–∞–º–∞, —è–∫–∞ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –Ω–∞ Windows 10/11 —Ç–∞ –≤–∏–∫–æ–Ω—É—î:
- –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É —á–µ—Ä–µ–∑ DXGI (Direct3D 11)
- –ê–ø–∞—Ä–∞—Ç–Ω–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è –≤ H.264
- –ü–µ—Ä–µ–¥–∞—á—É –ø–æ—Ç–æ–∫—É –Ω–∞ Backend —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ WebSocket
- –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è CPU (<5%) —Ç–∞ RAM (<100MB)

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- **TypeScript** - –æ—Å–Ω–æ–≤–Ω–∞ –º–æ–≤–∞
- **Node.js NAPI** - –Ω–∞—Ç–∏–≤–Ω—ñ –∞–¥–¥–æ–Ω–∏ –Ω–∞ C++
- **DXGI** - –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É (Desktop Duplication API)
- **Media Foundation** - H.264 –∫–æ–¥—É–≤–∞–Ω–Ω—è
- **WebSocket** - –ø–µ—Ä–µ–¥–∞—á–∞ –ø–æ—Ç–æ–∫—É

## üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

### –í–∏–º–æ–≥–∏
- Windows 10/11
- Node.js >= 18.0.0
- Visual Studio Build Tools (–¥–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó C++)
- Python 3.x (–¥–ª—è node-gyp)

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Build Tools

```powershell
# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —á–µ—Ä–µ–∑ npm
npm install --global windows-build-tools

# –ê–ë–û –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –≤—Ä—É—á–Ω—É:
# Visual Studio Build Tools 2019/2022
# https://visualstudio.microsoft.com/downloads/
```

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
cd packages/capture-client

# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
npm install

# –ó—ñ–±—Ä–∞—Ç–∏ –Ω–∞—Ç–∏–≤–Ω—ñ –º–æ–¥—É–ª—ñ
npm run build:native

# –ó—ñ–±—Ä–∞—Ç–∏ TypeScript
npm run build
```

## üöÄ –ó–∞–ø—É—Å–∫

### –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env`:

```env
# Server
SERVER_URL=ws://localhost:3001

# Capture Settings
CAPTURE_FPS=30
CAPTURE_QUALITY=75
CAPTURE_WIDTH=1920
CAPTURE_HEIGHT=1080
CAPTURE_CODEC=h264

# Hardware Encoding
HARDWARE_ENCODING=true

# Recording (optional)
ENABLE_RECORDING=false
RECORDING_PATH=./recordings

# Logging
LOG_LEVEL=info
```

### –ó–∞–ø—É—Å–∫ –∫–ª—ñ—î–Ω—Ç–∞

```bash
# Production
npm start

# Development (–∑ ts-node)
npm run dev
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
capture-client/
‚îú‚îÄ‚îÄ native/                 # C++ NAPI –º–æ–¥—É–ª—ñ
‚îÇ   ‚îú‚îÄ‚îÄ module.cpp          # –ì–æ–ª–æ–≤–Ω–∏–π –º–æ–¥—É–ª—å NAPI
‚îÇ   ‚îú‚îÄ‚îÄ screen-capture.h/cpp # DXGI –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è
‚îÇ   ‚îî‚îÄ‚îÄ encoder.h/cpp       # H.264 –∫–æ–¥—É–≤–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts            # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª
‚îÇ   ‚îú‚îÄ‚îÄ capture-manager.ts  # –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è
‚îÇ   ‚îú‚îÄ‚îÄ stream-sender.ts    # WebSocket –∫–ª—ñ—î–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ performance-monitor.ts # –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
‚îÇ   ‚îú‚îÄ‚îÄ config.ts           # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îÇ   ‚îî‚îÄ‚îÄ logger.ts           # –õ–æ–≥—É–≤–∞–Ω–Ω—è
‚îú‚îÄ‚îÄ binding.gyp             # node-gyp –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ README.md
```

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

### –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É
- **FPS**: 30+ (–≤–∏–º–æ–≥–∞ –∫–æ–Ω–∫—É—Ä—Å—É: –º—ñ–Ω—ñ–º—É–º 3 FPS)
- **–†–æ–∑–¥—ñ–ª—å–Ω—ñ—Å—Ç—å**: 720p+ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ 1080p)
- **CPU**: <5% –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ DXGI

### –ö–æ–¥—É–≤–∞–Ω–Ω—è
- **H.264**: –ê–ø–∞—Ä–∞—Ç–Ω–µ (NVENC/QuickSync) –∞–±–æ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ
- **–Ø–∫—ñ—Å—Ç—å**: 75 (–±–∞–ª–∞–Ω—Å –º—ñ–∂ —è–∫—ñ—Å—Ç—é —ñ —Ä–æ–∑–º—ñ—Ä–æ–º)
- **–ë—ñ—Ç—Ä–µ–π—Ç**: –î–∏–Ω–∞–º—ñ—á–Ω–∏–π (–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —è–∫–æ—Å—Ç—ñ)

### –ú–µ—Ä–µ–∂–∞
- **–ü—Ä–æ—Ç–æ–∫–æ–ª**: WebSocket (—Å—É–º—ñ—Å–Ω–∏–π –∑ Cloudflare)
- **–ü–µ—Ä–µ–¥–∞—á–∞**: 2-5 Mbps upload
- **–ó–∞—Ç—Ä–∏–º–∫–∞**: <100ms

## üìä –ü—Ä–æ—Ç–æ–∫–æ–ª –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó

### Client -> Server

#### 1. –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
```json
{
  "type": "identification",
  "clientType": "capture_client",
  "version": "2.0.0",
  "platform": "win32",
  "hostname": "DESKTOP-ABC123"
}
```

#### 2. –ú–µ—Ç–∞–¥–∞–Ω—ñ –∫–∞–¥—Ä—É
```json
{
  "type": "frame_metadata",
  "width": 1920,
  "height": 1080,
  "timestamp": 1704718800000,
  "frameNumber": 1234,
  "size": 45678
}
```

#### 3. –ë—ñ–Ω–∞—Ä–Ω—ñ –¥–∞–Ω—ñ (Binary WebSocket frame)
–ó–∞–∫–æ–¥–æ–≤–∞–Ω–∏–π H.264 –∫–∞–¥—Ä

#### 4. –ú–µ—Ç—Ä–∏–∫–∏
```json
{
  "type": "metrics",
  "data": {
    "fps": 30.2,
    "cpuUsage": 4.5,
    "memoryUsageMB": 85
  }
}
```

### Server -> Client

#### 1. –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫—É
```json
{
  "type": "command",
  "command": {
    "type": "start_capture"
  }
}
```

#### 2. –ö–æ–º–∞–Ω–¥–∞ –∑—É–ø–∏–Ω–∫–∏
```json
{
  "type": "command",
  "command": {
    "type": "stop_capture"
  }
}
```

#### 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
```json
{
  "type": "command",
  "command": {
    "type": "update_settings",
    "settings": {
      "fps": 60,
      "quality": 85
    }
  }
}
```

## üêõ –î–µ–±–∞–≥—ñ–Ω–≥

### –õ–æ–≥–∏
–õ–æ–≥–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `./logs/`:
- `capture-client-YYYY-MM-DD.log`

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—Ç–∏–≤–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–±—ñ—Ä–∫—É
node -e "console.log(require('./build/Release/screen_capture.node'))"

# –¢–µ—Å—Ç –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è
npm test
```

### –¢–∏–ø–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏

1. **–ù–µ –∫–æ–º–ø—ñ–ª—é—î—Ç—å—Å—è –Ω–∞—Ç–∏–≤–Ω–∏–π –º–æ–¥—É–ª—å**
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ Visual Studio Build Tools
   - `npm install --global windows-build-tools`

2. **–ù–µ –∑–∞—Ö–æ–ø–ª—é—î –µ–∫—Ä–∞–Ω**
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è DXGI

3. **–í–∏—Å–æ–∫–µ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è CPU**
   - –£–≤—ñ–º–∫–Ω—ñ—Ç—å –∞–ø–∞—Ä–∞—Ç–Ω–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è
   - –ó–º–µ–Ω—à—ñ—Ç—å FPS –∞–±–æ —è–∫—ñ—Å—Ç—å

## üìù TODO

### –ü–æ—Ç–æ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è (—à–∞–±–ª–æ–Ω)
- [x] TypeScript —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [x] WebSocket –∫–ª—ñ—î–Ω—Ç
- [x] –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- [x] –õ–æ–≥—É–≤–∞–Ω–Ω—è
- [ ] –ü–æ–≤–Ω–∞ DXGI —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è
- [ ] H.264 –∫–æ–¥—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ Media Foundation
- [ ] –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ

### –ù–µ–æ–±—Ö—ñ–¥–Ω–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏
1. **DXGI Capture** (`native/screen-capture.cpp`)
   - –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Direct3D 11
   - Desktop Duplication API
   - –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É—Ä –∑ GPU

2. **H.264 Encoding** (`native/encoder.cpp`)
   - Media Foundation Transform
   - –ê–ø–∞—Ä–∞—Ç–Ω–µ –∫–æ–¥—É–≤–∞–Ω–Ω—è (NVENC/QuickSync)
   - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±—ñ—Ç—Ä–µ–π—Ç—É

3. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è**
   - Zero-copy –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–∏—Ö
   - –ü—É–ª –±—É—Ñ–µ—Ä—ñ–≤
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –æ–±—Ä–æ–±–∫–∞

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

MIT

---

**–°—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è –∫–æ–Ω–∫—É—Ä—Å—É Informator 2025**
