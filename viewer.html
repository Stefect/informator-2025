<!DOCTYPE html><!DOCTYPE html><!DOCTYPE html><!DOCTYPE html><!DOCTYPE html>

<html lang="uk">

<head><html lang="uk">

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><html lang="uk">

    <title>Viewer - Informator</title>

    <link rel="icon" type="image/x-icon" href="favicon.ico">    <meta charset="UTF-8">

    <style>

        * {    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><html lang="uk"><html lang="uk">

            margin: 0;

            padding: 0;    <title>Viewer - Informator</title>

            box-sizing: border-box;

        }    <link rel="icon" type="image/x-icon" href="favicon.ico">    <meta charset="UTF-8">



        body {    <style>

            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);        * {    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><head>

            min-height: 100vh;

            padding: 20px;            margin: 0;

        }

            padding: 0;    <title>Viewer - Informator</title>

        .header {

            background: white;            box-sizing: border-box;

            padding: 20px;

            border-radius: 15px;        }    <link rel="icon" type="image/x-icon" href="favicon.ico">    <meta charset="UTF-8">    <meta charset="UTF-8">

            margin-bottom: 20px;

            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);

            display: flex;

            justify-content: space-between;        body {    <style>

            align-items: center;

            flex-wrap: wrap;            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

            gap: 15px;

        }            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);        * {    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="viewport" content="width=device-width, initial-scale=1.0">



        .header-left {            min-height: 100vh;

            display: flex;

            align-items: center;            padding: 20px;            margin: 0;

            gap: 15px;

        }        }



        .logo {            padding: 0;    <title>Informator - –ü–µ—Ä–µ–≥–ª—è–¥ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó</title>    <title>Informator - –°–∏—Å—Ç–µ–º–∞ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É</title>

            font-size: 40px;

        }        .header {



        .title h1 {            background: white;            box-sizing: border-box;

            font-size: 24px;

            color: #333;            padding: 20px;

            margin-bottom: 5px;

        }            border-radius: 15px;        }    <link rel="icon" type="image/x-icon" href="favicon.ico">    <link rel="icon" type="image/x-icon" href="favicon.ico">



        .title p {            margin-bottom: 20px;

            font-size: 14px;

            color: #666;            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);

        }

            display: flex;

        .connection-status {

            display: flex;            justify-content: space-between;        body {    <style>    <style>

            align-items: center;

            gap: 10px;            align-items: center;

            padding: 10px 20px;

            background: #f0f0f0;            flex-wrap: wrap;            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

            border-radius: 25px;

        }            gap: 15px;



        .status-indicator {        }            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);        * {        * {

            width: 12px;

            height: 12px;

            border-radius: 50%;

            background: #ef4444;        .header-left {            min-height: 100vh;

            animation: pulse 2s infinite;

        }            display: flex;



        .status-indicator.connected {            align-items: center;            padding: 20px;            margin: 0;            margin: 0;

            background: #10b981;

            animation: none;            gap: 15px;

        }

        }        }

        @keyframes pulse {

            0%, 100% { opacity: 1; }

            50% { opacity: 0.3; }

        }        .logo {            padding: 0;            padding: 0;



        .main-container {            font-size: 40px;

            background: white;

            border-radius: 15px;        }        .header {

            padding: 30px;

            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);

        }

        .title h1 {            background: white;            box-sizing: border-box;            box-sizing: border-box;

        .viewer-area {

            background: #000;            font-size: 24px;

            border-radius: 10px;

            overflow: hidden;            color: #333;            padding: 20px;

            position: relative;

            min-height: 500px;            margin-bottom: 5px;

            display: flex;

            align-items: center;        }            border-radius: 15px;        }        }

            justify-content: center;

        }



        #screen {        .title p {            margin-bottom: 20px;

            max-width: 100%;

            max-height: 70vh;            font-size: 14px;

            display: none;

        }            color: #666;            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);



        #screen.active {        }

            display: block;

        }            display: flex;



        .waiting-screen {        .connection-status {

            text-align: center;

            color: #666;            display: flex;            justify-content: space-between;        body {        body {

            padding: 50px;

        }            align-items: center;



        .waiting-screen .icon {            gap: 10px;            align-items: center;

            font-size: 80px;

            margin-bottom: 20px;            padding: 10px 20px;

            opacity: 0.3;

        }            background: #f0f0f0;            flex-wrap: wrap;            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;



        .waiting-screen h2 {            border-radius: 25px;

            font-size: 24px;

            margin-bottom: 10px;        }            gap: 15px;

        }



        .waiting-screen p {

            font-size: 16px;        .status-indicator {        }            background: #1a1a2e;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            color: #999;

        }            width: 12px;



        .stats-bar {            height: 12px;

            display: flex;

            justify-content: space-around;            border-radius: 50%;

            margin-top: 20px;

            padding: 20px;            background: #ef4444;        .header-left {            color: #fff;            color: #333;

            background: #f8f9fa;

            border-radius: 10px;            animation: pulse 2s infinite;

            flex-wrap: wrap;

            gap: 15px;        }            display: flex;

        }



        .stat-item {

            text-align: center;        .status-indicator.connected {            align-items: center;            min-height: 100vh;            min-height: 100vh;

        }

            background: #10b981;

        .stat-label {

            font-size: 12px;            animation: none;            gap: 15px;

            color: #666;

            margin-bottom: 5px;        }

            text-transform: uppercase;

        }        }            display: flex;            display: flex;



        .stat-value {        @keyframes pulse {

            font-size: 24px;

            font-weight: bold;            0%, 100% { opacity: 1; }

            color: #667eea;

        }            50% { opacity: 0.3; }



        @media (max-width: 768px) {        }        .logo {            flex-direction: column;            align-items: center;

            .header {

                flex-direction: column;

                text-align: center;

            }        .main-container {            font-size: 40px;



            .stats-bar {            background: white;

                flex-direction: column;

            }            border-radius: 15px;        }        }            justify-content: center;

        }

    </style>            padding: 30px;

</head>

<body>            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);

    <div class="header">

        <div class="header-left">        }

            <div class="logo">üëÅÔ∏è</div>

            <div class="title">        .title h1 {            padding: 20px;

                <h1>Informator Viewer</h1>

                <p>–ü–µ—Ä–µ–≥–ª—è–¥ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó</p>        .viewer-area {

            </div>

        </div>            background: #000;            font-size: 24px;

        <div class="connection-status">

            <span class="status-indicator" id="statusIndicator"></span>            border-radius: 10px;

            <span id="statusText">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...</span>

        </div>            overflow: hidden;            color: #333;        .header {        }

    </div>

            position: relative;

    <div class="main-container">

        <div class="viewer-area">            min-height: 500px;            margin-bottom: 5px;

            <img id="screen" alt="Screen stream">

            <div class="waiting-screen" id="waitingScreen">            display: flex;

                <div class="icon">üì∫</div>

                <h2>–û—á—ñ–∫—É–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó...</h2>            align-items: center;        }            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

                <p>–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞. –û—á—ñ–∫—É—î–º–æ –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó –≤—ñ–¥ —Ö–æ—Å—Ç–∞.</p>

            </div>            justify-content: center;

        </div>

        }

        <div class="stats-bar">

            <div class="stat-item">

                <div class="stat-label">üë• –ì–ª—è–¥–∞—á—ñ–≤</div>

                <div class="stat-value" id="viewersCount">0</div>        #screen {        .title p {            padding: 1rem 2rem;        .container {

            </div>

            <div class="stat-item">            max-width: 100%;

                <div class="stat-label">üìä FPS</div>

                <div class="stat-value" id="fps">0</div>            max-height: 70vh;            font-size: 14px;

            </div>

            <div class="stat-item">            display: none;

                <div class="stat-label">üì¶ –û—Ç—Ä–∏–º–∞–Ω–æ –∫–∞–¥—Ä—ñ–≤</div>

                <div class="stat-value" id="framesReceived">0</div>        }            color: #666;            box-shadow: 0 4px 12px rgba(0,0,0,0.2);            max-width: 900px;

            </div>

        </div>

    </div>

        #screen.active {        }

    <script>

        let ws = null;            display: block;

        let frameCount = 0;

        let fpsCounter = 0;        }            display: flex;            margin: 0 auto;

        let fpsInterval = null;



        const screen = document.getElementById('screen');

        const waitingScreen = document.getElementById('waitingScreen');        .waiting-screen {        .connection-status {

        const statusIndicator = document.getElementById('statusIndicator');

        const statusText = document.getElementById('statusText');            text-align: center;

        const viewersCountEl = document.getElementById('viewersCount');

        const fpsEl = document.getElementById('fps');            color: #666;            display: flex;            justify-content: space-between;            padding: 3rem;

        const framesReceivedEl = document.getElementById('framesReceived');

            padding: 50px;

        function connectWebSocket() {

            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';        }            align-items: center;

            const host = window.location.host || 'localhost:3001';

            const wsUrl = `${protocol}//${host}`;



            console.log('–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ:', wsUrl);        .waiting-screen .icon {            gap: 10px;            align-items: center;            background: white;



            try {            font-size: 80px;

                ws = new WebSocket(wsUrl);

            margin-bottom: 20px;            padding: 10px 20px;

                ws.onopen = () => {

                    console.log('–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');            opacity: 0.3;

                    statusIndicator.classList.add('connected');

                    statusText.textContent = '–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ';        }            background: #f0f0f0;        }            border-radius: 20px;



                    ws.send(JSON.stringify({

                        type: 'viewer_join'

                    }));        .waiting-screen h2 {            border-radius: 25px;



                    startFPSCounter();            font-size: 24px;

                };

            margin-bottom: 10px;        }            box-shadow: 0 20px 60px rgba(0,0,0,0.3);

                ws.onmessage = async (event) => {

                    try {        }

                        if (event.data instanceof Blob) {

                            const url = URL.createObjectURL(event.data);

                            screen.src = url;

                            screen.classList.add('active');        .waiting-screen p {

                            waitingScreen.style.display = 'none';

            font-size: 16px;        .status-indicator {        .header h1 {            text-align: center;

                            frameCount++;

                            fpsCounter++;            color: #999;

                            framesReceivedEl.textContent = frameCount;

        }            width: 12px;

                            setTimeout(() => URL.revokeObjectURL(url), 100);

                        } else {

                            const message = JSON.parse(event.data);

                            console.log('–û—Ç—Ä–∏–º–∞–Ω–æ:', message.type);        .stats-bar {            height: 12px;            font-size: 1.5rem;        }



                            if (message.type === 'stats' && message.viewerCount !== undefined) {            display: flex;

                                viewersCountEl.textContent = message.viewerCount;

                            }            justify-content: space-around;            border-radius: 50%;

                        }

                    } catch (error) {            margin-top: 20px;

                        console.error('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', error);

                    }            padding: 20px;            background: #ef4444;            display: flex;

                };

            background: #f8f9fa;

                ws.onerror = (error) => {

                    console.error('–ü–æ–º–∏–ª–∫–∞ WebSocket:', error);            border-radius: 10px;            animation: pulse 2s infinite;

                    statusText.textContent = '–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è';

                };            flex-wrap: wrap;



                ws.onclose = () => {            gap: 15px;        }            align-items: center;        .logo {

                    console.log('–ó\'—î–¥–Ω–∞–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç–æ');

                    statusIndicator.classList.remove('connected');        }

                    statusText.textContent = '–í—ñ–¥–∫–ª—é—á–µ–Ω–æ';

                    stopFPSCounter();



                    setTimeout(() => {        .stat-item {

                        console.log('–°–ø—Ä–æ–±–∞ –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...');

                        connectWebSocket();            text-align: center;        .status-indicator.connected {            gap: 0.5rem;            font-size: 4rem;

                    }, 3000);

                };        }

            } catch (error) {

                console.error('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è WebSocket:', error);            background: #10b981;

            }

        }        .stat-label {



        function startFPSCounter() {            font-size: 12px;            animation: none;        }            margin-bottom: 0.5rem;

            fpsInterval = setInterval(() => {

                fpsEl.textContent = fpsCounter;            color: #666;

                fpsCounter = 0;

            }, 1000);            margin-bottom: 5px;        }

        }

            text-transform: uppercase;

        function stopFPSCounter() {

            if (fpsInterval) {        }        }

                clearInterval(fpsInterval);

                fpsInterval = null;

            }

            fpsEl.textContent = '0';        .stat-value {        @keyframes pulse {

        }

            font-size: 24px;

        connectWebSocket();

            font-weight: bold;            0%, 100% { opacity: 1; }        .status {

        window.addEventListener('beforeunload', () => {

            if (ws && ws.readyState === WebSocket.OPEN) {            color: #667eea;

                ws.close();

            }        }            50% { opacity: 0.3; }

        });

    </script>

</body>

</html>        @media (max-width: 768px) {        }            display: flex;        h1 {


            .header {

                flex-direction: column;

                text-align: center;

            }        .main-container {            align-items: center;            color: #667eea;



            .stats-bar {            background: white;

                flex-direction: column;

            }            border-radius: 15px;            gap: 1rem;            margin-bottom: 0.5rem;

        }

    </style>            padding: 30px;

</head>

<body>            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);            font-size: 0.9rem;            font-size: 2.5rem;

    <div class="header">

        <div class="header-left">        }

            <div class="logo">üëÅÔ∏è</div>

            <div class="title">        }        }

                <h1>Informator Viewer</h1>

                <p>–ü–µ—Ä–µ–≥–ª—è–¥ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó</p>        .viewer-area {

            </div>

        </div>            background: #000;

        <div class="connection-status">

            <span class="status-indicator" id="statusIndicator"></span>            border-radius: 10px;

            <span id="statusText">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...</span>

        </div>            overflow: hidden;        .status-indicator {        .subtitle {

    </div>

            position: relative;

    <div class="main-container">

        <div class="viewer-area">            min-height: 500px;            width: 12px;            color: #666;

            <img id="screen" alt="Screen stream">

            <div class="waiting-screen" id="waitingScreen">            display: flex;

                <div class="icon">üì∫</div>

                <h2>–û—á—ñ–∫—É–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó...</h2>            align-items: center;            height: 12px;            margin-bottom: 2rem;

                <p>–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞. –û—á—ñ–∫—É—î–º–æ –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó –≤—ñ–¥ —Ö–æ—Å—Ç–∞.</p>

            </div>            justify-content: center;

        </div>

        }            border-radius: 50%;            font-size: 1.2rem;

        <div class="stats-bar">

            <div class="stat-item">

                <div class="stat-label">üë• –ì–ª—è–¥–∞—á—ñ–≤</div>

                <div class="stat-value" id="viewersCount">0</div>        #screen {            background: #ef4444;        }

            </div>

            <div class="stat-item">            max-width: 100%;

                <div class="stat-label">üìä FPS</div>

                <div class="stat-value" id="fps">0</div>            max-height: 70vh;            animation: pulse 2s infinite;

            </div>

            <div class="stat-item">            display: none;

                <div class="stat-label">üì¶ –û—Ç—Ä–∏–º–∞–Ω–æ –∫–∞–¥—Ä—ñ–≤</div>

                <div class="stat-value" id="framesReceived">0</div>        }        }        .description {

            </div>

        </div>

    </div>

        #screen.active {            color: #555;

    <script>

        let ws = null;            display: block;

        let frameCount = 0;

        let fpsCounter = 0;        }        .status-indicator.connected {            font-size: 1rem;

        let fpsInterval = null;

        let viewersCount = 0;



        const screen = document.getElementById('screen');        .waiting-screen {            background: #10b981;            line-height: 1.8;

        const waitingScreen = document.getElementById('waitingScreen');

        const statusIndicator = document.getElementById('statusIndicator');            text-align: center;

        const statusText = document.getElementById('statusText');

        const viewersCountEl = document.getElementById('viewersCount');            color: #666;        }            margin-bottom: 3rem;

        const fpsEl = document.getElementById('fps');

        const framesReceivedEl = document.getElementById('framesReceived');            padding: 50px;



        function connectWebSocket() {        }            text-align: left;

            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';

            const host = window.location.host || 'localhost:3001';

            const wsUrl = `${protocol}//${host}`;

        .waiting-screen .icon {        @keyframes pulse {            padding: 0 1rem;

            console.log('–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ:', wsUrl);

            font-size: 80px;

            try {

                ws = new WebSocket(wsUrl);            margin-bottom: 20px;            0%, 100% { opacity: 1; }        }



                ws.onopen = () => {            opacity: 0.3;

                    console.log('–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');

                    statusIndicator.classList.add('connected');        }            50% { opacity: 0.5; }

                    statusText.textContent = '–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ';



                    // –†–µ—î—Å—Ç—Ä—É—î–º–æ—Å—è —è–∫ VIEWER

                    ws.send(JSON.stringify({        .waiting-screen h2 {        }        .features {

                        type: 'viewer_join'

                    }));            font-size: 24px;



                    startFPSCounter();            margin-bottom: 10px;            display: grid;

                };

        }

                ws.onmessage = async (event) => {

                    try {        .main-content {            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));

                        if (event.data instanceof Blob) {

                            // –û—Ç—Ä–∏–º–∞–ª–∏ –∫–∞–¥—Ä –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è        .waiting-screen p {

                            const url = URL.createObjectURL(event.data);

                            screen.src = url;            font-size: 16px;            flex: 1;            gap: 1.5rem;

                            screen.classList.add('active');

                            waitingScreen.style.display = 'none';            color: #999;



                            frameCount++;        }            display: flex;            margin: 2rem 0;

                            fpsCounter++;

                            framesReceivedEl.textContent = frameCount;



                            setTimeout(() => URL.revokeObjectURL(url), 100);        .stats-bar {            align-items: center;        }

                        } else {

                            // JSON –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è            display: flex;

                            const message = JSON.parse(event.data);

                            console.log('–û—Ç—Ä–∏–º–∞–Ω–æ:', message.type);            justify-content: space-around;            justify-content: center;



                            if (message.type === 'stats' && message.viewerCount !== undefined) {            margin-top: 20px;

                                viewersCount = message.viewerCount;

                                viewersCountEl.textContent = viewersCount;            padding: 20px;            padding: 2rem;        .feature-card {

                            }

                        }            background: #f8f9fa;

                    } catch (error) {

                        console.error('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', error);            border-radius: 10px;        }            background: #f8fafc;

                    }

                };            flex-wrap: wrap;



                ws.onerror = (error) => {            gap: 15px;            padding: 2rem;

                    console.error('–ü–æ–º–∏–ª–∫–∞ WebSocket:', error);

                    statusText.textContent = '–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è';        }

                };

        .viewer-container {            border-radius: 12px;

                ws.onclose = () => {

                    console.log('–ó\'—î–¥–Ω–∞–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç–æ');        .stat-item {

                    statusIndicator.classList.remove('connected');

                    statusText.textContent = '–í—ñ–¥–∫–ª—é—á–µ–Ω–æ';            text-align: center;            width: 100%;            transition: transform 0.3s ease, box-shadow 0.3s ease;

                    stopFPSCounter();

        }

                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏

                    setTimeout(() => {            max-width: 1400px;        }

                        console.log('–°–ø—Ä–æ–±–∞ –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...');

                        connectWebSocket();        .stat-label {

                    }, 3000);

                };            font-size: 12px;            background: #16213e;

            } catch (error) {

                console.error('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è WebSocket:', error);            color: #666;

            }

        }            margin-bottom: 5px;            border-radius: 12px;        .feature-card:hover {



        function startFPSCounter() {            text-transform: uppercase;

            fpsInterval = setInterval(() => {

                fpsEl.textContent = fpsCounter;        }            box-shadow: 0 8px 32px rgba(0,0,0,0.3);            transform: translateY(-5px);

                fpsCounter = 0;

            }, 1000);

        }

        .stat-value {            overflow: hidden;            box-shadow: 0 10px 25px rgba(0,0,0,0.1);

        function stopFPSCounter() {

            if (fpsInterval) {            font-size: 24px;

                clearInterval(fpsInterval);

                fpsInterval = null;            font-weight: bold;        }        }

            }

            fpsEl.textContent = '0';            color: #667eea;

        }

        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ

        connectWebSocket();



        // –ó–∞–∫—Ä–∏—Ç—Ç—è –∑'—î–¥–Ω–∞–Ω–Ω—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏        @media (max-width: 768px) {        .screen-container {        .feature-card .icon {

        window.addEventListener('beforeunload', () => {

            if (ws && ws.readyState === WebSocket.OPEN) {            .header {

                ws.close();

            }                flex-direction: column;            position: relative;            font-size: 3rem;

        });

    </script>                text-align: center;

</body>

</html>            }            width: 100%;            margin-bottom: 1rem;




            .stats-bar {            background: #0f172a;        }

                flex-direction: column;

            }            display: flex;

        }

    </style>            align-items: center;        .feature-card h3 {

</head>

<body>            justify-content: center;            color: #1e293b;

    <div class="header">

        <div class="header-left">            min-height: 500px;            margin-bottom: 0.5rem;

            <div class="logo">üëÅÔ∏è</div>

            <div class="title">        }        }

                <h1>Informator Viewer</h1>

                <p>–ü–µ—Ä–µ–≥–ª—è–¥ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó</p>

            </div>

        </div>        #screen {        .feature-card p {

        <div class="connection-status">

            <span class="status-indicator" id="statusIndicator"></span>            max-width: 100%;            color: #64748b;

            <span id="statusText">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...</span>

        </div>            max-height: 80vh;            font-size: 0.9rem;

    </div>

            display: none;        }

    <div class="main-container">

        <div class="viewer-area">            border-radius: 8px;

            <img id="screen" alt="Screen stream">

            <div class="waiting-screen" id="waitingScreen">        }        .cta-section {

                <div class="icon">üì∫</div>

                <h2>–û—á—ñ–∫—É–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó...</h2>            margin: 3rem 0 2rem;

                <p>–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞. –û—á—ñ–∫—É—î–º–æ –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó –≤—ñ–¥ —Ö–æ—Å—Ç–∞.</p>

            </div>        #screen.visible {            padding: 2rem;

        </div>

            display: block;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

        <div class="stats-bar">

            <div class="stat-item">        }            border-radius: 15px;

                <div class="stat-label">üë• –ì–ª—è–¥–∞—á—ñ–≤</div>

                <div class="stat-value" id="viewersCount">0</div>            color: white;

            </div>

            <div class="stat-item">        .waiting-message {        }

                <div class="stat-label">üìä FPS</div>

                <div class="stat-value" id="fps">0</div>            text-align: center;

            </div>

            <div class="stat-item">            padding: 3rem;        .cta-section h2 {

                <div class="stat-label">üì¶ –û—Ç—Ä–∏–º–∞–Ω–æ –∫–∞–¥—Ä—ñ–≤</div>

                <div class="stat-value" id="framesReceived">0</div>        }            margin-bottom: 1.5rem;

            </div>

        </div>            font-size: 1.8rem;

    </div>

        .waiting-message .icon {        }

    <script>

        let ws = null;            font-size: 4rem;

        let frameCount = 0;

        let fpsCounter = 0;            margin-bottom: 1rem;        .role-buttons {

        let fpsInterval = null;

        let viewersCount = 0;            opacity: 0.5;            display: grid;



        const screen = document.getElementById('screen');        }            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));

        const waitingScreen = document.getElementById('waitingScreen');

        const statusIndicator = document.getElementById('statusIndicator');            gap: 2rem;

        const statusText = document.getElementById('statusText');

        const viewersCountEl = document.getElementById('viewersCount');        .waiting-message h2 {            margin-top: 2rem;

        const fpsEl = document.getElementById('fps');

        const framesReceivedEl = document.getElementById('framesReceived');            color: #94a3b8;        }



        function connectWebSocket() {            margin-bottom: 0.5rem;

            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';

            const host = window.location.host || 'localhost:3001';        }        .role-card {

            const wsUrl = `${protocol}//${host}`;

            background: white;

            console.log('–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ:', wsUrl);

        .waiting-message p {            padding: 2rem;

            try {

                ws = new WebSocket(wsUrl);            color: #64748b;            border-radius: 15px;



                ws.onopen = () => {        }            text-align: center;

                    console.log('–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');

                    statusIndicator.classList.add('connected');            transition: transform 0.3s ease;

                    statusText.textContent = '–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ';

        .info-bar {        }

                    // –†–µ—î—Å—Ç—Ä—É—î–º–æ—Å—è —è–∫ VIEWER

                    ws.send(JSON.stringify({            background: #0f172a;

                        type: 'viewer_join'

                    }));            padding: 1rem 2rem;        .role-card:hover {



                    startFPSCounter();            display: flex;            transform: scale(1.05);

                };

            justify-content: space-between;        }

                ws.onmessage = async (event) => {

                    try {            align-items: center;

                        if (event.data instanceof Blob) {

                            // –û—Ç—Ä–∏–º–∞–ª–∏ –∫–∞–¥—Ä –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è            font-size: 0.85rem;        .role-card .icon {

                            const url = URL.createObjectURL(event.data);

                            screen.src = url;            color: #94a3b8;            font-size: 4rem;

                            screen.classList.add('active');

                            waitingScreen.style.display = 'none';        }            margin-bottom: 1rem;



                            frameCount++;        }

                            fpsCounter++;

                            framesReceivedEl.textContent = frameCount;        .info-item {



                            setTimeout(() => URL.revokeObjectURL(url), 100);            display: flex;        .role-card h3 {

                        } else {

                            // JSON –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è            align-items: center;            color: #1e293b;

                            const message = JSON.parse(event.data);

                            console.log('–û—Ç—Ä–∏–º–∞–Ω–æ:', message.type);            gap: 0.5rem;            margin-bottom: 1rem;



                            if (message.type === 'stats' && message.viewerCount !== undefined) {        }            font-size: 1.5rem;

                                viewersCount = message.viewerCount;

                                viewersCountEl.textContent = viewersCount;        }

                            }

                        }        .info-item strong {

                    } catch (error) {

                        console.error('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', error);            color: #fff;        .role-card p {

                    }

                };        }            color: #64748b;



                ws.onerror = (error) => {            margin-bottom: 1.5rem;

                    console.error('–ü–æ–º–∏–ª–∫–∞ WebSocket:', error);

                    statusText.textContent = '–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è';        .error-message {            font-size: 0.95rem;

                };

            background: #ef4444;        }

                ws.onclose = () => {

                    console.log('–ó\'—î–¥–Ω–∞–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç–æ');            color: white;

                    statusIndicator.classList.remove('connected');

                    statusText.textContent = '–í—ñ–¥–∫–ª—é—á–µ–Ω–æ';            padding: 1rem;        .button {

                    stopFPSCounter();

            margin: 1rem;            display: inline-block;

                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏

                    setTimeout(() => {            border-radius: 8px;            background: linear-gradient(45deg, #667eea, #764ba2);

                        console.log('–°–ø—Ä–æ–±–∞ –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...');

                        connectWebSocket();            display: none;            color: white;

                    }, 3000);

                };        }            text-decoration: none;

            } catch (error) {

                console.error('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è WebSocket:', error);            padding: 14px 32px;

            }

        }        .error-message.show {            border-radius: 30px;



        function startFPSCounter() {            display: block;            font-weight: 600;

            fpsInterval = setInterval(() => {

                fpsEl.textContent = fpsCounter;        }            font-size: 1.1rem;

                fpsCounter = 0;

            }, 1000);            transition: all 0.3s ease;

        }

        @media (max-width: 768px) {            border: none;

        function stopFPSCounter() {

            if (fpsInterval) {            .header {            cursor: pointer;

                clearInterval(fpsInterval);

                fpsInterval = null;                flex-direction: column;        }

            }

            fpsEl.textContent = '0';                gap: 1rem;

        }

                text-align: center;        .button:hover {

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ

        connectWebSocket();            }            transform: translateY(-2px);



        // –ó–∞–∫—Ä–∏—Ç—Ç—è –∑'—î–¥–Ω–∞–Ω–Ω—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);

        window.addEventListener('beforeunload', () => {

            if (ws && ws.readyState === WebSocket.OPEN) {            .info-bar {        }

                ws.close();

            }                flex-direction: column;

        });

    </script>                gap: 0.5rem;        .button.host {

</body>

</html>            }            background: linear-gradient(45deg, #f093fb, #f5576c);


        }        }

    </style>

</head>        .button.host:hover {

<body>            box-shadow: 0 10px 25px rgba(245, 87, 108, 0.4);

    <div class="header">        }

        <h1>

            <span>üëÅÔ∏è</span>        .button.viewer {

            <span>Informator Viewer</span>            background: linear-gradient(45deg, #667eea, #764ba2);

        </h1>        }

        <div class="status">

            <span class="status-indicator" id="statusIndicator"></span>        .button.viewer:hover {

            <span id="statusText">–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...</span>            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);

        </div>        }

    </div>

        .footer {

    <div class="error-message" id="errorMessage"></div>            margin-top: 3rem;

            padding-top: 2rem;

    <div class="main-content">            border-top: 2px solid #e2e8f0;

        <div class="viewer-container">            color: #64748b;

            <div class="screen-container">            font-size: 0.9rem;

                <img id="screen" alt="Screen stream">        }

                <div class="waiting-message" id="waitingMessage">

                    <div class="icon">üì∫</div>        @media (max-width: 768px) {

                    <h2>–û—á—ñ–∫—É–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—ó...</h2>            .container {

                    <p>–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ —ñ –ø–æ—á–µ–∫–∞–π—Ç–µ, –ø–æ–∫–∏ —Ö–æ—Å—Ç —Ä–æ–∑–ø–æ—á–Ω–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—é</p>                padding: 2rem 1.5rem;

                </div>            }

            </div>

            <div class="info-bar">            h1 {

                <div class="info-item">                font-size: 2rem;

                    <span>üë• –ì–ª—è–¥–∞—á—ñ–≤:</span>            }

                    <strong id="viewerCount">0</strong>

                </div>            .role-buttons {

                <div class="info-item">                grid-template-columns: 1fr;

                    <span>üìä FPS:</span>            }

                    <strong id="fps">0</strong>            animation: pulse 2s infinite;

                </div>        }

                <div class="info-item">

                    <span>üì¶ –û—Ç—Ä–∏–º–∞–Ω–æ –∫–∞–¥—Ä—ñ–≤:</span>        .status-connected .status-dot {

                    <strong id="frameCount">0</strong>            background: #00aa00;

                </div>        }

            </div>

        </div>        .status-disconnected .status-dot {

    </div>            background: #cc0000;

        }

    <script>

        let ws = null;        @keyframes pulse {

        let frameCount = 0;            0% { opacity: 1; }

        let lastFrameTime = Date.now();            50% { opacity: 0.5; }

        let fpsCounter = 0;            100% { opacity: 1; }

        let fpsInterval = null;        }



        // –ï–ª–µ–º–µ–Ω—Ç–∏ DOM        .footer {

        const screen = document.getElementById('screen');            margin-top: 2rem;

        const waitingMessage = document.getElementById('waitingMessage');            padding-top: 1rem;

        const statusIndicator = document.getElementById('statusIndicator');            border-top: 1px solid #eee;

        const statusText = document.getElementById('statusText');            font-size: 0.9rem;

        const errorMessage = document.getElementById('errorMessage');            color: #777;

        const viewerCountEl = document.getElementById('viewerCount');        }

        const fpsEl = document.getElementById('fps');    </style>

        const frameCountEl = document.getElementById('frameCount');</head>

<body>

        // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ WebSocket    <div class="container">

        function connectWebSocket() {        <div class="logo">üì∫ Informator</div>

            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';        <h1>–°–∏—Å—Ç–µ–º–∞ –∑–∞—Ö–æ–ø–ª–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω—É</h1>

            const wsUrl = `${protocol}//${window.location.host}`;        <p>–ü–µ—Ä–µ–≥–ª—è–¥ —Ä–æ–±–æ—á–æ–≥–æ —Å—Ç–æ–ª—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ</p>

        

            try {        <div class="status">

                ws = new WebSocket(wsUrl);            <div id="connectionStatus" class="status-indicator status-disconnected">

                <div class="status-dot"></div>

                ws.onopen = () => {                <span>–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...</span>

                    console.log('‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');            </div>

                    statusIndicator.classList.add('connected');        </div>

                    statusText.textContent = '–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ';

                            <div class="screen-container">

                    // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è —è–∫ –≥–ª—è–¥–∞—á            <canvas id="screenCanvas"></canvas>

                    ws.send(JSON.stringify({            <div id="loadingMessage" class="loading">

                        type: 'viewer_join'                –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞... 

                    }));                <br><small>–ü—ñ—Å–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–¢–µ—Å—Ç –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è" –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó</small>

            </div>

                    startFPSCounter();        </div>

                };

        <div class="controls">

                ws.onmessage = async (event) => {            <button class="button" onclick="connect()">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å</button>

                    try {            <button class="button" onclick="disconnect()">–í—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å</button>

                        if (event.data instanceof Blob) {            <button class="button secondary" onclick="toggleFullscreen()">–ü–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω</button>

                            // –û—Ç—Ä–∏–º–∞–Ω–æ –∫–∞–¥—Ä –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è            <button class="button secondary" onclick="sendTestImage()">–¢–µ—Å—Ç –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</button>

                            const imageUrl = URL.createObjectURL(event.data);        </div>

                            screen.src = imageUrl;

                            screen.classList.add('visible');        <!-- –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è remote –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è -->

                            waitingMessage.style.display = 'none';        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin: 2rem 0; border-left: 4px solid #667eea;">

            <h3 style="margin: 0 0 1rem 0; color: #2c3e50;">üåê –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∑ —ñ–Ω—à–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤</h3>

                            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏            <p style="margin: 0 0 0.5rem 0;"><strong>–ü–æ—Ç–æ—á–Ω–∞ –∞–¥—Ä–µ—Å–∞:</strong> <span id="currentUrl" style="color: #667eea; font-family: monospace;"></span></p>

                            frameCount++;            <p style="margin: 0 0 1rem 0; font-size: 0.9rem; color: #666;">

                            fpsCounter++;                –°–∫–æ–ø—ñ—é–π—Ç–µ —Ü—é –∞–¥—Ä–µ—Å—É —Ç–∞ –≤—ñ–¥–∫—Ä–∏–π—Ç–µ –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó –≤ —Ç—ñ–π –∂–µ –º–µ—Ä–µ–∂—ñ

                            frameCountEl.textContent = frameCount;            </p>

            <details style="margin-top: 1rem;">

                            // –û—á–∏—â–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ URL                <summary style="cursor: pointer; font-weight: bold; color: #667eea;">üì± –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è</summary>

                            setTimeout(() => URL.revokeObjectURL(imageUrl), 100);                <div style="margin-top: 1rem; padding-left: 1rem;">

                        } else {                    <p><strong>üíª –ó –∫–æ–º–ø'—é—Ç–µ—Ä–∞:</strong> –í—ñ–¥–∫—Ä–∏–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä —Ç–∞ –≤–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É –≤–∏—â–µ</p>

                            // JSON –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è                    <p><strong>üì± –ó —Ç–µ–ª–µ—Ñ–æ–Ω—É/–ø–ª–∞–Ω—à–µ—Ç–∞:</strong> –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ —Ç—ñ—î—ó –∂ Wi-Fi –º–µ—Ä–µ–∂—ñ —Ç–∞ –≤—ñ–¥–∫—Ä–∏–π—Ç–µ –∞–¥—Ä–µ—Å—É –≤ –±—Ä–∞—É–∑–µ—Ä—ñ</p>

                            const data = JSON.parse(event.data);                    <p><strong>üîó QR –∫–æ–¥:</strong> <span id="qrStatus">–ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è...</span></p>

                            handleMessage(data);                    <div id="qrCode" style="margin: 1rem 0; text-align: center;"></div>

                        }                </div>

                    } catch (error) {            </details>

                        console.error('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', error);        </div>

                    }

                };        <div class="footer">

            <p>¬© 2025 Informator Team - –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –µ–∫—Ä–∞–Ω—É</p>

                ws.onerror = (error) => {            <p><small>–û—Ç—Ä–∏–º–∞–Ω–æ –∫–∞–¥—Ä—ñ–≤: <span id="frameCounter">0</span></small></p>

                    console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ WebSocket:', error);        </div>

                    showError('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');    </div>

                };

    <script>

                ws.onclose = () => {        let ws = null;

                    console.log('üîå –ó\'—î–¥–Ω–∞–Ω–Ω—è –∑–∞–∫—Ä–∏—Ç–æ');        let canvas = null;

                    statusIndicator.classList.remove('connected');        let ctx = null;

                    statusText.textContent = '–í—ñ–¥–∫–ª—é—á–µ–Ω–æ';        let isConnected = false;

                    stopFPSCounter();        let frameCount = 0;

                    

                    // –°–ø—Ä–æ–±–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏        function initializeCanvas() {

                    setTimeout(() => {            canvas = document.getElementById('screenCanvas');

                        console.log('üîÑ –°–ø—Ä–æ–±–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...');            ctx = canvas.getContext('2d');

                        connectWebSocket();            canvas.style.display = 'none';

                    }, 3000);        }

                };

            } catch (error) {        function connect() {

                console.error('‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è —Å—Ç–≤–æ—Ä–∏—Ç–∏ WebSocket:', error);            if (ws && ws.readyState === WebSocket.OPEN) {

                showError('–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');                return;

            }            }

        }

            try {

        function handleMessage(data) {                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î–º–æ –∞–¥—Ä–µ—Å—É —Å–µ—Ä–≤–µ—Ä–∞

            switch (data.type) {                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';

                case 'stats':                const host = window.location.host || 'localhost:3001';

                    if (data.viewerCount !== undefined) {                const wsUrl = `${protocol}//${host}`;

                        viewerCountEl.textContent = data.viewerCount;                

                    }                console.log('–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ:', wsUrl);

                    break;                ws = new WebSocket(wsUrl);

                

                case 'client_list':                ws.onopen = function() {

                    if (data.viewers !== undefined) {                    console.log('–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ WebSocket —Å–µ—Ä–≤–µ—Ä–∞');

                        viewerCountEl.textContent = data.viewers;                    updateConnectionStatus(true);

                    }                    document.getElementById('loadingMessage').textContent = '–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤—ñ–¥–µ–æ...';

                    break;                    

                    // –ü–æ–≤—ñ–¥–æ–º–ª—è—î–º–æ —Å–µ—Ä–≤–µ—Ä —â–æ –º–∏ viewer

                case 'error':                    ws.send(JSON.stringify({

                    showError(data.message || '–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞');                        type: 'viewer_join'

                    break;                    }));

                };

                default:

                    console.log('–û—Ç—Ä–∏–º–∞–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', data);                ws.onmessage = function(event) {

            }                    try {

        }                        // –°–ø—Ä–æ–±—É—î–º–æ –ø–∞—Ä—Å–∏—Ç–∏ —è–∫ JSON –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

                        const message = JSON.parse(event.data);

        function startFPSCounter() {                        console.log('–û—Ç—Ä–∏–º–∞–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:', message.type);

            fpsInterval = setInterval(() => {                        

                fpsEl.textContent = fpsCounter;                        if (message.type === 'connected') {

                fpsCounter = 0;                            document.getElementById('loadingMessage').innerHTML = 

            }, 1000);                                '–ì–æ—Ç–æ–≤–æ –¥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å<br><small>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–¢–µ—Å—Ç –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è" —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–±–æ—Ç—É —Å–∏—Å—Ç–µ–º–∏</small>';

        }                        }

                    } catch (e) {

        function stopFPSCounter() {                        // –Ø–∫—â–æ —Ü–µ –Ω–µ JSON, —Ç–æ —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ –±—ñ–Ω–∞—Ä–Ω—ñ –¥–∞–Ω—ñ (–∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è)

            if (fpsInterval) {                        if (event.data instanceof Blob) {

                clearInterval(fpsInterval);                            const img = new Image();

                fpsInterval = null;                            img.onload = function() {

            }                                // –ü—ñ–¥–≥–∞–Ω—è—î–º–æ —Ä–æ–∑–º—ñ—Ä canvas –ø—ñ–¥ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è, –∞–ª–µ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø—Ä–æ–ø–æ—Ä—Ü—ñ—ó

            fpsEl.textContent = '0';                                const maxWidth = 760;

        }                                const maxHeight = 380;

                                let newWidth = img.width;

        function showError(message) {                                let newHeight = img.height;

            errorMessage.textContent = message;                                

            errorMessage.classList.add('show');                                if (newWidth > maxWidth) {

            setTimeout(() => {                                    newHeight = (newHeight * maxWidth) / newWidth;

                errorMessage.classList.remove('show');                                    newWidth = maxWidth;

            }, 5000);                                }

        }                                

                                if (newHeight > maxHeight) {

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ                                    newWidth = (newWidth * maxHeight) / newHeight;

        connectWebSocket();                                    newHeight = maxHeight;

                                }

        // –û—á–∏—â–µ–Ω–Ω—è –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏                                

        window.addEventListener('beforeunload', () => {                                canvas.width = newWidth;

            if (ws && ws.readyState === WebSocket.OPEN) {                                canvas.height = newHeight;

                ws.close();                                ctx.drawImage(img, 0, 0, newWidth, newHeight);

            }                                canvas.style.display = 'block';

        });                                document.getElementById('loadingMessage').style.display = 'none';

    </script>                                

</body>                                frameCount++;

</html>                                document.getElementById('frameCounter').textContent = frameCount;

                                console.log('–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è #' + frameCount + ':', newWidth + 'x' + newHeight);
                            };
                            img.src = URL.createObjectURL(event.data);
                        }
                    }
                };

                ws.onclose = function() {
                    console.log('–í—ñ–¥–∫–ª—é—á–µ–Ω–æ –≤—ñ–¥ WebSocket —Å–µ—Ä–≤–µ—Ä–∞');
                    updateConnectionStatus(false);
                    document.getElementById('loadingMessage').textContent = '–ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—Ç—Ä–∞—á–µ–Ω–æ. –°–ø—Ä–æ–±–∞ –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è...';
                    document.getElementById('loadingMessage').style.display = 'block';
                    canvas.style.display = 'none';
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
                    setTimeout(() => {
                        if (!isConnected) {
                            connect();
                        }
                    }, 3000);
                };

                ws.onerror = function(error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ WebSocket:', error);
                    updateConnectionStatus(false);
                    document.getElementById('loadingMessage').textContent = '–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞';
                };

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è WebSocket:', error);
                updateConnectionStatus(false);
                document.getElementById('loadingMessage').textContent = '–ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞';
            }
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
            updateConnectionStatus(false);
            frameCount = 0;
            document.getElementById('frameCounter').textContent = frameCount;
            document.getElementById('loadingMessage').innerHTML = '–í—ñ–¥–∫–ª—é—á–µ–Ω–æ<br><small>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å" –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑\'—î–¥–Ω–∞–Ω–Ω—è</small>';
            document.getElementById('loadingMessage').style.display = 'block';
            canvas.style.display = 'none';
        }

        function updateConnectionStatus(connected) {
            isConnected = connected;
            const statusElement = document.getElementById('connectionStatus');
            if (connected) {
                statusElement.className = 'status-indicator status-connected';
                statusElement.innerHTML = '<div class="status-dot"></div><span>–ü—ñ–¥–∫–ª—é—á–µ–Ω–æ</span>';
            } else {
                statusElement.className = 'status-indicator status-disconnected';
                statusElement.innerHTML = '<div class="status-dot"></div><span>–í—ñ–¥–∫–ª—é—á–µ–Ω–æ</span>';
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function sendTestImage() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                alert('WebSocket –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π. –°–ø–æ—á–∞—Ç–∫—É –ø—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞.');
                return;
            }

            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–∏–º—á–∞—Å–æ–≤–∏–π canvas –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            const testCanvas = document.createElement('canvas');
            testCanvas.width = 800;
            testCanvas.height = 600;
            const testCtx = testCanvas.getContext('2d');

            // –°—Ç–≤–æ—Ä—é—î–º–æ –≥—Ä–∞–¥—ñ—î–Ω—Ç–Ω–∏–π —Ñ–æ–Ω
            const gradient = testCtx.createLinearGradient(0, 0, 800, 600);
            gradient.addColorStop(0, '#667eea');
            gradient.addColorStop(1, '#764ba2');
            testCtx.fillStyle = gradient;
            testCtx.fillRect(0, 0, 800, 600);

            // –î–æ–¥–∞—î–º–æ —Ç–µ–∫—Å—Ç
            testCtx.fillStyle = 'white';
            testCtx.font = 'bold 48px Arial';
            testCtx.textAlign = 'center';
            testCtx.fillText('üñ•Ô∏è INFORMATOR TEST', 400, 200);

            testCtx.font = '32px Arial';
            testCtx.fillText('Screen Capture System', 400, 260);

            testCtx.font = '24px Arial';
            testCtx.fillText('–ß–∞—Å: ' + new Date().toLocaleTimeString(), 400, 320);

            // –î–æ–¥–∞—î–º–æ –∞–Ω—ñ–º–æ–≤–∞–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç
            const time = Date.now() / 1000;
            const x = 400 + Math.sin(time) * 100;
            const y = 400 + Math.cos(time) * 50;

            testCtx.fillStyle = '#FFD700';
            testCtx.beginPath();
            testCtx.arc(x, y, 20, 0, 2 * Math.PI);
            testCtx.fill();

            // –†–∞–º–∫–∞
            testCtx.strokeStyle = 'white';
            testCtx.lineWidth = 5;
            testCtx.strokeRect(10, 10, 780, 580);

            // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            testCanvas.toBlob(function(blob) {
                if (blob) {
                    ws.send(blob);
                    console.log('–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è');
                }
            }, 'image/jpeg', 0.9);
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.onload = function() {
            initializeCanvas();
            updateCurrentUrl(); // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ—ó URL —Ç–∞ QR –∫–æ–¥—É
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(connect, 1000);
            
            // Ping –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è
            setInterval(function() {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({ type: 'ping' }));
                }
            }, 30000);
        };

        function updateCurrentUrl() {
            const currentUrl = window.location.href;
            document.getElementById('currentUrl').textContent = currentUrl;
            
            // –ü—Ä–æ—Å—Ç–∏–π QR –∫–æ–¥ —á–µ—Ä–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ–π —Å–µ—Ä–≤—ñ—Å
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(currentUrl)}`;
            document.getElementById('qrCode').innerHTML = `<img src="${qrUrl}" alt="QR –∫–æ–¥ –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è" style="border: 1px solid #ddd; border-radius: 5px;">`;
            document.getElementById('qrStatus').textContent = '–í—ñ–¥—Å–∫–∞–Ω—É–π—Ç–µ QR –∫–æ–¥ –∫–∞–º–µ—Ä–æ—é —Ç–µ–ª–µ—Ñ–æ–Ω—É';
        }

        // –û–±—Ä–æ–±–∫–∞ –∫–ª–∞–≤—ñ—à
        document.addEventListener('keydown', function(event) {
            if (event.key === 'F11') {
                event.preventDefault();
                toggleFullscreen();
            }
        });
    </script>
</body>
</html>
